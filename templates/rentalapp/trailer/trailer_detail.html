{% extends 'rentalapp/base.html' %}
{% load static %}

{% block title %}Szczegóły przyczepki{% endblock title %}

{% block content %}
    <div class="card mb-3">
        <div class="card-header">
            <h5>Przyczepka: {{ trailer.name }}</h5>
        </div>
        <div class="card-body d-flex">

            <div class="me-4">
                <img src="{% static 'rentalapp/img/trailer_default.png' %}" alt="Zdjęcie przyczepki" class="img-fluid"
                     style="max-width: 250px;">
            </div>

            <div>
                <p><strong>IP:</strong> {{ trailer.ip_address }}</p>
                <p><strong>Nr seryjny:</strong> {{ trailer.serial_number }}</p>
                <p><strong>Nr rejestracyjny:</strong> {{ trailer.registration_number }}</p>
                <p><strong>Telefon operatora:</strong> {{ trailer.operator_phone }}</p>
                <p><strong>Status:</strong> {{ trailer.get_status_display }}</p>
                <p><strong>Notatki:</strong> {{ trailer.notes }}</p>
                {% if trailer.location_link %}
                    <p><strong>Mapa / Lokalizacja:</strong></p>
                    <a href="{{ trailer.location_link }}" target="_blank" class="btn btn-info btn-sm">
                        <i class="fa fa-map-marker"></i> Otwórz mapę
                    </a>
                {% endif %}
            </div>
        </div>

        <div class="card-footer d-flex gap-2 flex-wrap">
            <a href="{% url 'rentalapp:trailer_edit' trailer.pk %}" class="btn btn-warning">
                <i class="fa fa-pencil"></i> Edytuj
            </a>
            <button id="loadLogsBtn" data-url="{% url 'rentalapp:trailer_logs' trailer.pk %}" class="btn btn-info">
                Pokaż logi
            </button>
            <a href="{% url 'rentalapp:send_for_service' trailer.pk %}" class="btn btn-info">
                Wyślij na serwis
            </a>
            <form method="POST" action="{% url 'rentalapp:trailer_delete' trailer.pk %}"
                  onsubmit="return confirm('Czy na pewno chcesz usunąć tę przyczepkę?');">
                {% csrf_token %}
                <button type="submit" class="btn btn-danger">
                    <i class="fa fa-trash"></i> Usuń
                </button>
            </form>
        </div>
    </div>

    <div class="card" id="logsContainer">
    </div>

    <script>
        document.getElementById('loadLogsBtn').addEventListener('click', function () {
            var url = this.getAttribute('data-url');
            fetch(url)
                .then(response => response.text())
                .then(html => {
                    document.getElementById('logsContainer').innerHTML = html;
                })
                .catch(error => console.error('Błąd podczas ładowania logów:', error));
        });
    </script>

{% endblock content %}
